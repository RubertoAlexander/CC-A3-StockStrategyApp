{% extends 'index.html' %}

{% block content %}

<br>

<body class = "container">
    <div class="row">
        <div class="col-10">
            <h3>{{stock.name}}</h3>
            <div class="row">
                <h5 class="col-5">{{stock.symbol}}      ${{stock.prices.price}}</h5>
                <span class="col-6"></span>
                <a id="fav" class="col-1" href="#">
                    <i class="bi bi-star"></i>
                </a>
                <p>
                    Open: ${{stock.prices.open}}
                    High: ${{stock.prices.high}}
                    Low: ${{stock.prices.low}}
                    Close: ${{stock.prices.close}}
                </p>
            </div>
            <!-- TradingView Widget BEGIN -->
            <div class="tradingview-widget-container row">
                <div id="tradingview_5dde6" style="height: 650px; min-height: 500px;"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                <script type="text/javascript">
                    new TradingView.widget(
                    {
                        "autosize": true,
                        "symbol": "ASX:{{stock.symbol}}",
                        "interval": "D",
                        "timezone": "Australia/Sydney",
                        "theme": "light",
                        "style": "1",
                        "locale": "en",
                        "toolbar_bg": "#f1f3f6",
                        "enable_publishing": false,
                        "withdateranges": true,
                        "hide_side_toolbar": false,
                        "container_id": "tradingview_5dde6"
                    }
                    );
                </script>
            </div>
            <!-- TradingView Widget END -->
        </div>
        <div class="col">
            <div class="list-group">
                <h5 class="mb-1">Favourites</h5>
                {% for fav in favs %}
                    <button class="list-group-item list-group-item-action border" id={{fav}} href="/stock/{{fav}}">{{fav}}</button>
                {% endfor %}
            </div>
        </div>
    </div>

</body>

<script type="text/javascript">

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('a#fav').forEach(item => {
            item.onclick = () => {
                fetch(`/fav/{{stock.symbol}}`, {
                    method: "POST",
                    credentials: "include",
                    cache: "no-cache",
                    headers: new Headers({
                    "content-type": "application/json"
                    })
                }).then(function (response) {
                    response.json().then(function(data) {
                        icon = item.firstElementChild
                        console.log(icon)
                        if(data == true) {
                            icon.classList.remove("bi-star")
                            icon.classList.add("bi-star-fill")
                        }
                        else {
                            icon.classList.remove("bi-star-fill")
                            icon.classList.add("bi-star")
                        }
                    });
                });
            };
        });
    });
</script>
{% endblock %}